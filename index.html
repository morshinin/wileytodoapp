<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Wiley todo app</title>
	<!-- Get Materialize icon font -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!-- Get Materialize stylesheet via CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.2/css/materialize.min.css">

	<!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
  	/* Helper classes */
  	.cursor-pointer:hover {
  		cursor: pointer;
  	}

		/* Items list */
		.items-list__item {
  		position: relative;		
		}

  	.items-list__item:hover .items-list__icon {
  		display: inline-block;
  	}

  	.items-list__icon {
  		position: absolute;
  		display: none;
  	}

  	.items-list__icon:hover {
  		cursor: pointer;
  		color: black;
  	}

  	.items-list__icon_delete {
			right: 5rem;
  	}

  	.items-list__icon_edit {
  		right: 7rem;
  	}
  </style>
</head>
<body class="container">
	<h1>Wiley todo app</h1>
	<div class="row">
		<!-- Main form -->
		<form id="todoForm">
			<div class="input-field">
				<label for="itemTitle">What to do?</label>
				<input type="text" id="itemTitle" name="itemTitle">
			</div>
			<div class="input-field">
				<label for="itemDesc">Description</label>
				<input type="text" id="itemDesc" name="itemDesc">
			</div>
			<button type="submit" id="submitBtn" class="btn-floating btn-large waves-effect waves-light red right"><i class="material-icons">add</i></button>
		</form>
	</div><!-- .row -->

	<div class="row">
		<!-- List of items -->
		<ul id="itemsList" class="items-list">
			<li>
			  <label class="items-list__label cursor-pointer">
			    <input type="checkbox" />
			    <span>Buy milk</span>
			    <span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Officiis, ab?</span>
					<i class="material-icons items-list__icon items-list__icon_delete">delete</i>
					<i class="material-icons items-list__icon items-list__icon_edit">edit</i>
			  </label>
			</li>
		</ul>
	</div><!-- .row -->
	<div class="row">
		<a class="waves-effect waves-light btn" id="deleteAll"><i class="material-icons left">delete</i>Delete all</a>
	</div>

	<!-- Get Materialize JS via CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.2/js/materialize.min.js"></script>

	<script>
		const 
					// itemTitle = document.querySelector('#itemTitle'),
					deleteAllBtn = document.querySelector('#deleteAll'),
					todoForm = document.querySelector('#todoForm'),
					itemsList = document.querySelector('#itemsList');
		let items = JSON.parse(localStorage.getItem('items')) || [];

		// Listen to submit
		todoForm.addEventListener('submit', setItem);

		// Listen to delete or edit list
		itemsList.addEventListener('click', operateItem);

		// Listen to delete all button
		deleteAllBtn.addEventListener('click', deleteAll);

		// Create new item and append it to list
		function setItem(e) {
			e.preventDefault();

			const title = this.querySelector('[name=itemTitle]').value,
						desc = this.querySelector('[name=itemDesc]').value;

			const item = {
				title,
				desc,
				done: false
			};

			// Push item to items array
			items.push(item);

			// Add item to items list
			appendItem(items, itemsList);

			// Save items to local storage
			localStorage.setItem('items', JSON.stringify(items));

			// Reset form inputs
			this.reset();
		}

		// Adding items to items list
		function appendItem(items = [], itemsList) {
			itemsList.innerHTML = items.map((item, i) => {
				return `
				<li class="items-list__item">
			 		<label class="items-list__label cursor-pointer">
			 			<input type="checkbox" data-index="${i}" id="item-${i}" ${item.done ? "checked" : ""} />
			 			<span class="items-list__item-title">${item.title}</span>
			 			<span>${item.desc}</span>
			 		</label>
			 			<i class="material-icons items-list__icon items-list__icon_delete">delete</i>
			 			<i class="material-icons items-list__icon items-list__icon_edit">edit</i>
				</li>
		 	`;
			}).join('');
		}

		// Delete or edit item
		function operateItem(e) {
			const el = e.target,
						deleteItem = el.querySelector('i.items-list__icon_delete'),
						editItem = el.querySelector('i.items-list__icon_edit');
						// itemTitle = el.querySelector('.items-list__item-title').value;

			// If clicked delete icon then delete current item,
			// if clicked edit then edit
			// else do nothing
			if (e.target.matches('.items-list__icon_delete')) {
				itemsList.removeChild(e.target.parentElement);
				// localStorage.removeItem(itemTitle);
				console.log(e.target.parentElement);
			} else if (e.target.matches('.items-list__icon_edit')) {
				console.log('ok');
				
			} else {
				return;
			}
		}

		// Delete all items
		function deleteAll(e) {
			e.preventDefault();

			while (itemsList.firstChild) {
				itemsList.removeChild(itemsList.firstChild);
			}

			localStorage.clear();
			items = [];
		}

		// Items list init
		appendItem(items, itemsList);

		// ToDo
		// Remove item from localStorage when deleted
		// Edit item
		// Update localStorage when edit item
		// Sort items
		// Save checked items

		// Done
		// Add delete all button
	</script>
</body>
</html>